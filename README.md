# addm-awr-reports

ADDM (Automatic Database Diagnostics Monitor) - это модуль самодиагностики базы данных, встроенный непосредственно в ядро Oracle Database. ADDM периодически проверяет состояние БД, автоматически выявляет в ней узкие места, приводящие к потере производительности, и даёт рекомендации по их устранению. 

Необходимую для анализа информацию о работе базы данных ADDM берёт из специального репозитория AWR (Automatic Workload Repository), встроенного в БД Oracle. Через регулярные интервалы времени (по умолчанию один час) Oracle Database делает снимки наиболее важной статистики о работе базы данных и сохраняет их в AWR. Эта информация периодически удаляется из AWR (по умолчанию через 1 неделю), чтобы избежать его переполнения. AWR содержит всю необходимую информацию для восстановления полной картины того, что происходило с базой данных, в любой момент прошлого. Это даёт возможность диагностировать трудноуловимые и трудновоспроизводимые проблемы. AWR также хранит ADDM рекомендации, сделанные после каждого снимка статистики. Поэтому задача диагностики проблем с производительностью базы данных, случившихся в прошлом, существенно упрощается, достаточно взглянуть на рекомендации ADDM за соответствующий период времени.

Скрипты размещенные в данном репозитории позволяют сформировать отчеты ADDM и АWR за указанный пользователем период, а именно:
* `addm_and_awr_report.sql` - за указанный день;
* `addm_and_awr_report_hour.sql` - за указанный промежуток времени.

## Порядок использования 
1. Cкачать [последнюю версию скриптов](https://github.com/ParusPmo/addm-awr-reports/releases/latest)
2. Запустить SQL*Plus, выполнить соединение с БД под пользователем __с правами SYSDBA__
3. Выполнить необходимый скрипт.

### Пример использования

Предположим, что необходимо сформировать отчет о работе БД `PARUZ` за период с 10 до 12 часов 18 мая 2013 года. Скачанные и распакованные скрипты находятся по пути `C:\work\oracle\` _(избегайте пробелов и неанглийских символов в путях)_. Тогда: 

Из коммандной строки выполняем команду запуска SQL*Plus, например:
```
C:\>sqlplus /nolog
```
В коммандной строке SQL, задаем БД к которой собираемся присоединиться:
```
SQL> set instance PARUZ
```
Выполняем соединение, указывая пароль:
```
SQL> connect sys as sysdba
Enter password:
```
Запускаем скрипт:
```
SQL> @C:\work\oracle\addm_and_awr_report_hour.sql
```
Вводим дату начала отчета:
```
Enter report start time (YYYY-MM-DD  HH24): 2013-05-18 10
```
Вводим дату окончания отчета:
```
Enter report end time (YYYY-MM-DD  HH24): 2013-05-18 12
```
Вводим номер экземпляра БД в кластере (если у Вас не кластер, или Вы вообще не понимаете, о чем это, то просто жмите `Enter` соглашаясь со знеачением по умолчянию `1`:
```
Enter instance (default=1):
```
Далее необходимо ввести путь, куда будут записаны отчеты (по умолчанию корень диска `D`). Если Вы согласны со значением по умолчанию, просто жмите `Enter`, если хотите использовать другой путь, введите его без завершающего символа косой черты _(избегайте пробелов и неанглийских символов в путях)_, например:
```
Enter path to report without trailing "\" (default=D:): C:\Logs
```
В результате (если данные за указанный период не устарели и автоматически не удалились, и БД не перезапускалось после заданного периода), по указанному пути будут созданы файлы отчетов:
  * `ADDM#2013-05-18 10#1.txt`
  * `AWR#2013-05-18 10#1.html`


Удачи вам в успешном поиске проблем и узких мест в производительности вашей БД!
